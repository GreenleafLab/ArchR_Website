---
title: "Tutorial Part 3 - Identifying Cell Types"
---

```{r image, include=FALSE}
knitr::include_graphics(
  c()
  )
```

# 6. Identifying Cluster Cell Types Using Marker Genes {.tabset .tabset-fade .tabset-pills}

In order to understand which clusters correspond to which cell types, we use a supervised approach based on prior knowledge of the genes that are active in specific cell types. We determine _gene activity scores_ for each putative marker gene based on chromatin accessibility signal in the region surrounding the gene's promoter. We can then overlay these _gene activity scores_ on our UMAP embedding to visualize the relationship between gene activity and cluster. For more details, see the [marker genes vignette](articles/Articles/geneScores.html).

```{r eval=FALSE}

#Add Imputation Weights for imputing numerical values based on Magic (see van Dijk et. al. 2018).
proj <- addImputeWeights(ArchRProj = proj)

markerGenes  <- c(
    "CD34", #Early Progenitor
    "GATA1", #Erythroid
    "PAX5", "MS4A1", #B-Cell Trajectory
    "CD14", #Monocytes
    "CD3D", "CD8A", "TBX21", "IL7R" #TCells
  )

#Plot the UMAP Embedding with Marker Genes Overlayed w/ Imputation
plotList <- list()
plotList[[1]] <- plotEmbedding(ArchRProj = proj, colorBy = "GeneScoreMatrix", name = markerGenes, imputeWeights = getImputeWeights(proj))
plotPDF(plotList = plotList, name = "UMAP-Marker-Gene-Scores-w-Imputation", width = 6, height = 6, ArchRProj = proj, addDOC = FALSE)

#Plot the UMAP Embedding with Marker Genes Overlayed w/o Imputation
plotList <- list()
plotList[[1]] <- plotEmbedding(ArchRProj = proj, colorBy = "GeneScoreMatrix", name = markerGenes)
plotPDF(plotList = plotList, name = "UMAP-Marker-Gene-Scores-wo-Imputation", width = 6, height = 6, ArchRProj = proj, addDOC = FALSE)

#Plot Tracks at Marker Genes
plotTracks <- ArchRRegionTrack(ArchRProj = proj, geneSymbol = markerGenes)
plotPDF(plotList = plotTracks, name = "Plot-Tracks-Marker-Genes", width = 6, height = 8, ArchRProj = proj, addDOC = FALSE)

#Identify Marker Gene through Pairwise Test vs Bias-Matched Background 
markersGS <- markerFeatures(ArchRProj = proj, useMatrix = "GeneScoreMatrix", groupBy = "Clusters")
heatmapGS <- markerHeatmap(
  seMarker = markersGS, 
  cutOff = "FDR <= 0.01 & Log2FC >= 1", 
  labelMarkers = markerGenes
)
plotPDF(heatmapGS, name = "GeneScores-Marker-Heatmap", width = 8, height = 12, ArchRProj = proj, addDOC = FALSE)
```
***

## UMAP GeneScores w/ Imputation {.tabset .tabset-fade .tabset-pills}
This [plot](../../images/Tutorial/UMAP-Marker-Gene-Scores-w-Imputation.pdf) shows gene activity scores of the marker genes described above overlayed onto the UMAP embedding. The gene scores are imputed using Magic when running addImupteWeights. (Note if you see a blank space below try firefox or safari)

### 1
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_1.png){width=600 height=600}

### 2
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_2.png){width=600 height=600}

### 3
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_3.png){width=600 height=600}

### 4
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_4.png){width=600 height=600}

### 5
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_5.png){width=600 height=600}

### 6
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_6.png){width=600 height=600}

### 7
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_7.png){width=600 height=600}

### 8
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_8.png){width=600 height=600}

### 9
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-w-Imputation_9.png){width=600 height=600}

## UMAP GeneScores w/o Imputation {.tabset .tabset-fade .tabset-pills}
This [plot](../../images/Tutorial/UMAP-Marker-Gene-Scores-wo-Imputation.pdf) shows gene activity scores of the marker genes described above overlayed onto the UMAP embedding. (Note if you see a blank space below try firefox or safari)

### 1
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_1.png){width=600 height=600}

### 2
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_2.png){width=600 height=600}

### 3
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_3.png){width=600 height=600}

### 4
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_4.png){width=600 height=600}

### 5
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_5.png){width=600 height=600}

### 6
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_6.png){width=600 height=600}

### 7
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_7.png){width=600 height=600}

### 8
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_8.png){width=600 height=600}

### 9
![](../../images/Tutorial2/UMAP-Marker-Gene-Scores-wo-Imputation_9.png){width=600 height=600}

## Track-Plots {.tabset .tabset-fade .tabset-pills}

### 1
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_1.png){width=600 height=900}

### 2
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_2.png){width=600 height=900}

### 3
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_3.png){width=600 height=900}

### 4
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_4.png){width=600 height=900}

### 5
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_5.png){width=600 height=900}

### 6
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_6.png){width=600 height=900}

### 7
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_7.png){width=600 height=900}

### 8
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_8.png){width=600 height=900}

### 9
![](../../images/Tutorial2/Plot-Tracks-Marker-Genes_9.png){width=600 height=900}

## Marker GeneScores Heatmap {.tabset .tabset-fade .tabset-pills}

![](../../images/Tutorial2/GeneScores-Marker-Heatmap_1.png){width=600 height=900}