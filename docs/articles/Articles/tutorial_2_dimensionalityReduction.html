<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial Part 2 - Dimensionality Reduction and Clustering â€¢ ArchR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Tutorial Part 2 - Dimensionality Reduction and Clustering">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">ArchR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Articles/tutorial_0_intro.html">ArchR Basics</a>
    </li>
    <li>
      <a href="../../articles/Articles/tutorial_1_ArchRProject.html">1 - Setting up an ArchRProject</a>
    </li>
    <li>
      <a href="../../articles/Articles/tutorial_2_dimensionalityReduction.html">2 - Dimenstionality Reduction</a>
    </li>
    <li>
      <a href="../../articles/Articles/tutorial_3_identifyingCellTypes.html">3 - Identifying Cell Types</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-file-text-o"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Articles/inputFiles.html">Input File Types</a>
    </li>
    <li>
      <a href="../../articles/Articles/doubletRemoval.html">Doublet Removal</a>
    </li>
    <li>
      <a href="../../articles/Articles/qcFilters.html">QC Filters</a>
    </li>
    <li>
      <a href="../../articles/Articles/peakCalling.html">Peak Calling</a>
    </li>
    <li>
      <a href="../../articles/Articles/dimReduction.html">Dimensionality Reduction</a>
    </li>
    <li>
      <a href="../../articles/Articles/geneScores.html">Gene Activity Scores</a>
    </li>
    <li>
      <a href="../../articles/Articles/markerFeatures.html">Marker Feature Identification</a>
    </li>
    <li>
      <a href="../../articles/Articles/signalTracks.html">Signal Track Ploting</a>
    </li>
    <li>
      <a href="../../articles/Articles/footprinting.html">TF Footprinting</a>
    </li>
    <li>
      <a href="../../articles/Articles/pseudobulkGeneration.html">Pseudobulk Replicate Generation</a>
    </li>
    <li>
      <a href="../../articles/Articles/annotations.html">Gene and Genome Annotation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/Articles/faq.html">
    <span class="fa fa-question-circle-o"></span>
     
    FAQ
  </a>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fa fa-code"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GreenleafLab/ArchR">
    <span class="fa fa-github"></span>
     
    ArchR on GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tutorial Part 2 - Dimensionality Reduction and Clustering</h1>
            
      
      
      <div class="hidden name"><code>tutorial_2_dimensionalityReduction.Rmd</code></div>

    </div>

    
    
<div id="dimensionality-reduction" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#dimensionality-reduction" class="anchor"></a>1. Dimensionality Reduction</h1>
<p>At this point, we have an ArchR project that is ready to be used in downstream visualizations and analyses. The first thing we will do is use an iterative latent semantic indexing (LSI) approach to define clusters in our data. Once we have identified clusters in our data, we can plot a UMAP embedding. For more details, see the <a href="articles/Articles/dimReduction.html">dimensionality reduction vignette</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Reduce Dimensions with Iterative LSI (~5-10 minutes)</span>
proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addIterativeLSI.html">addIterativeLSI</a></span>(
  <span class="dt">ArchRProj =</span> proj, 
  <span class="dt">useMatrix =</span> <span class="st">"TileMatrix"</span>, 
  <span class="dt">reducedDimsOut =</span> <span class="st">"IterativeLSI"</span>
)

<span class="co">#Identify Clusters from Iterative LSI</span>
<span class="co">#By default ArchR uses Seurat's FindClusters function because it is fast/robust producing reasonable clustering.</span>
<span class="co">#The larger the resolution the more clusters will be called. The lower the resolution hte less clusters will be called.</span>
<span class="co">#It is recommended to compare the results from your clusters and your embeddings and find params that best agree across</span>
<span class="co">#both analyses for clarity.</span>
proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addClusters.html">addClusters</a></span>(<span class="dt">input =</span> proj, <span class="dt">reducedDims =</span> <span class="st">"IterativeLSI"</span>, <span class="dt">resolution =</span> <span class="fl">0.6</span>)

<span class="co">#Compute a UMAP embedding to visualize our tiled accessibility matrix in a 2-d setting.</span>
proj &lt;-<span class="st"> </span><span class="kw">addEmbedding</span>(
  <span class="dt">ArchRProj =</span> proj, 
  <span class="dt">reducedDims =</span> <span class="st">"IterativeLSI"</span>, 
  <span class="dt">embedding =</span> <span class="st">"UMAP"</span>, 
  <span class="dt">embeddingParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min_dist =</span> <span class="fl">0.4</span>) <span class="co">#see uwot::umap for alternative params</span>
)

<span class="co">#Plot the UMAP Embedding with Metadata Overlayed such as Experimental Sample and Clusters.</span>
<span class="co">#To change plotting aesthetics see ?plotEmbedding parameters.</span>
plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Sample"</span>)
plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))
<span class="co">#Different ArchRPalette "circus"</span>
plotList[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">discreteSet =</span> <span class="st">"circus"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))
<span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Samples-Clusters"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</code></pre></div>
<hr>
<div id="umap-w-clusters" class="section level2 tabset tabset-fade tabset-pills">
<h2 class="hasAnchor">
<a href="#umap-w-clusters" class="anchor"></a>UMAP w/ Clusters</h2>
<p>This <a href="../../images/Tutorial/UMAP-Samples-Clusters.pdf">plot</a> shows gene experimental samples and clusters described above overlayed onto the UMAP embedding. (Note if you see a blank space below try firefox or safari)</p>
<div id="section" class="section level3">
<h3 class="hasAnchor">
<a href="#section" class="anchor"></a>1</h3>
<div class="figure">
<img src="../../images/Tutorial2/UMAP-Samples-Clusters_1.png" width="600" height="600">
</div>
</div>
<div id="section-1" class="section level3">
<h3 class="hasAnchor">
<a href="#section-1" class="anchor"></a>2</h3>
<div class="figure">
<img src="../../images/Tutorial2/UMAP-Samples-Clusters_2.png" width="600" height="600">
</div>
</div>
<div id="section-2" class="section level3">
<h3 class="hasAnchor">
<a href="#section-2" class="anchor"></a>3</h3>
<div class="figure">
<img src="../../images/Tutorial2/UMAP-Samples-Clusters_3.png" width="600" height="600">
</div>
</div>
</div>
<div id="tsne-w-clusters" class="section level2 tabset tabset-fade tabset-pills">
<h2 class="hasAnchor">
<a href="#tsne-w-clusters" class="anchor"></a>TSNE w/ Clusters</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Compute a TSNE embedding to visualize our tiled accessibility matrix in a 2-d setting.</span>
proj &lt;-<span class="st"> </span><span class="kw">addEmbedding</span>(
  <span class="dt">ArchRProj =</span> proj, 
  <span class="dt">reducedDims =</span> <span class="st">"IterativeLSI"</span>, 
  <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, 
  <span class="dt">embeddingParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">perplexity =</span> <span class="dv">50</span>)
  )

<span class="co">#Plot the TSNE Embedding with Metadata Overlayed such as Experimental Sample and Clusters.</span>
<span class="co">#To change plotting aesthetics see ?plotEmbedding parameters.</span>
plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, <span class="dt">name =</span> <span class="st">"Sample"</span>)
plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))
<span class="co">#Different ArchRPalette "circus"</span>
plotList[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">discreteSet =</span> <span class="st">"circus"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))
<span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"TSNE-Samples-Clusters"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div id="section-3" class="section level3">
<h3 class="hasAnchor">
<a href="#section-3" class="anchor"></a>1</h3>
<div class="figure">
<img src="../../images/Tutorial2/TSNE-Samples-Clusters_1.png" width="600" height="600">
</div>
</div>
<div id="section-4" class="section level3">
<h3 class="hasAnchor">
<a href="#section-4" class="anchor"></a>2</h3>
<div class="figure">
<img src="../../images/Tutorial2/TSNE-Samples-Clusters_2.png" width="600" height="600">
</div>
</div>
<div id="section-5" class="section level3">
<h3 class="hasAnchor">
<a href="#section-5" class="anchor"></a>3</h3>
<div class="figure">
<img src="../../images/Tutorial2/TSNE-Samples-Clusters_3.png" width="600" height="600">
</div>
</div>
</div>
<div id="umap-w-custom-coldata" class="section level2 tabset tabset-fade tabset-pills">
<h2 class="hasAnchor">
<a href="#umap-w-custom-coldata" class="anchor"></a>UMAP w/ Custom ColData</h2>
<p>To add your own information for plotting ontop of UMAP embedding we will show an example here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Get Cell Names</span>
cellNames &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getCellNames.html">getCellNames</a></span>(<span class="dt">ArchRProj =</span> proj)

<span class="co">#Get Sample names</span>
sampleNames &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getCellColData.html">getCellColData</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">select =</span> <span class="st">"Sample"</span>, <span class="dt">drop =</span> <span class="ot">TRUE</span>)

<span class="co">#Remove Replicate Name</span>
sampleNames &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"_R1"</span>, <span class="st">""</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"_R2"</span>, <span class="st">""</span>, sampleNames))

<span class="co">#Add Info to cellColData</span>
proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addCellColData.html">addCellColData</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">data =</span> sampleNames, <span class="dt">cells =</span> cellNames, <span class="dt">name =</span> <span class="st">"Type"</span>)

<span class="co">#Plot the UMAP Embedding with Metadata Overlayed such as Experimental Sample and Clusters.</span>
<span class="co">#To change plotting aesthetics see ?plotEmbedding parameters.</span>
plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Type"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))
plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Type"</span>, <span class="dt">discreteSet =</span> <span class="st">"circus"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))
<span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Samples-Type"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div id="section-6" class="section level3">
<h3 class="hasAnchor">
<a href="#section-6" class="anchor"></a>1</h3>
<div class="figure">
<img src="../../images/Tutorial2/UMAP-Samples-Type_1.png" width="600" height="600">
</div>
</div>
<div id="section-7" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7" class="anchor"></a>2</h3>
<div class="figure">
<img src="../../images/Tutorial2/UMAP-Samples-Type_2.png" width="600" height="600">
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#dimensionality-reduction">1. Dimensionality Reduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#umap-w-clusters">UMAP w/ Clusters</a></li>
      <li><a href="#tsne-w-clusters">TSNE w/ Clusters</a></li>
      <li><a href="#umap-w-custom-coldata">UMAP w/ Custom ColData</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://twitter.com/JeffreyGranja">Jeffrey Granja</a>, <a href="https://twitter.com/doctorcorces">Ryan Corces</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
