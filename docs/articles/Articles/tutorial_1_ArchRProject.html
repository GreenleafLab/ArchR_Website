<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial Part 1 - Setting Up an ArchRProject • ArchR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Tutorial Part 1 - Setting Up an ArchRProject">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">ArchR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Articles/tutorial_0_intro.html">ArchR Basics</a>
    </li>
    <li>
      <a href="../../articles/Articles/tutorial_1_ArchRProject.html">1 - Setting up an ArchRProject</a>
    </li>
    <li>
      <a href="../../articles/Articles/tutorial_2_dimensionalityReduction.html">2 - Dimenstionality Reduction</a>
    </li>
    <li>
      <a href="../../articles/Articles/tutorial_3_identifyingCellTypes.html">3 - Identifying Cell Types</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Articles/inputFiles.html">Input File Types</a>
    </li>
    <li>
      <a href="../../articles/Articles/doubletRemoval.html">Doublet Removal</a>
    </li>
    <li>
      <a href="../../articles/Articles/qcFilters.html">QC Filters</a>
    </li>
    <li>
      <a href="../../articles/Articles/peakCalling.html">Peak Calling</a>
    </li>
    <li>
      <a href="../../articles/Articles/dimReduction.html">Dimensionality Reduction</a>
    </li>
    <li>
      <a href="../../articles/Articles/geneScores.html">Gene Activity Scores</a>
    </li>
    <li>
      <a href="../../articles/Articles/markerFeatures.html">Marker Feature Identification</a>
    </li>
    <li>
      <a href="../../articles/Articles/signalTracks.html">Signal Track Ploting</a>
    </li>
    <li>
      <a href="../../articles/Articles/footprinting.html">TF Footprinting</a>
    </li>
    <li>
      <a href="../../articles/Articles/pseudobulkGeneration.html">Pseudobulk Replicate Generation</a>
    </li>
    <li>
      <a href="../../articles/Articles/annotations.html">Gene and Genome Annotation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/Articles/faq.html">FAQ</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GreenleafLab/ArchR">
    <span class="fa fa-github"></span>
     
    ArchR on GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tutorial Part 1 - Setting Up an ArchRProject</h1>
            
      
      
      <div class="hidden name"><code>tutorial_1_ArchRProject.Rmd</code></div>

    </div>

    
    
<div id="getting-set-up" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-set-up" class="anchor"></a>1. Getting Set Up</h1>
<p>The first thing we do is set up our working directory, load our gene and genome annotations, and set the number of threads we would like to use. Depending on the configuration of your local environment, you may need to modify the number of <code>threads</code> used below in <code><a href="../../reference/addArchRThreads.html">addArchRThreads()</a></code>. By default ArchR uses half of the total number of <code>threads</code> available but you can adjust this manually as you see fit. If you are using windows, the usable <code>threads</code> will automatically be set to 1 because the parallel processing in ArchR is build for Unix-based operating systems.</p>
<p>For the purposes of this tutorial, we provide the gene and genome annotations but you can create your own using the <code>createGeneAnnotation()</code> and <code><a href="../../reference/createGenomeAnnotation.html">createGenomeAnnotation()</a></code> functions. See the <a href="articles/Articles/annotations.html">Gene and Genome Annotations vignette</a> for more information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Load R Libraries</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ArchR)

<span class="co">#Create a new folder and set this as the working directory for tutorial analyses</span>
wd &lt;-<span class="st"> "ArchR_tutorial"</span>
<span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(wd, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(wd)

<span class="co">#Load genome annotations. Available annotations are for "Hg19", "Hg38", "Mm9", or "Mm10". QQQ THIS DOESNT MAKE SENSE. THE DATA IS HUMAN, NOT MOUSE, AND IS ONLY AVAILABLE FOR ONE GENOME FOR THE TUTORIAL? WOULD REMOVE.</span>
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"geneAnnoHg19"</span>)
<span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"genomeAnnoHg19"</span>)
geneAnno &lt;-<span class="st"> </span>geneAnnoHg19
genomeAnno &lt;-<span class="st"> </span>genomeAnnoHg19

<span class="co">#Set Default Threads for ArchR Functions</span>
<span class="kw"><a href="../../reference/addArchRThreads.html">addArchRThreads</a></span>(<span class="dt">threads =</span> <span class="kw"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(parallel::<span class="kw">detectCores</span>()/<span class="dv">2</span>)) <span class="co">#QQQ I favor including default values to make it clear what happens. Open to suggestions though.</span></code></pre></div>
</div>
<div id="creating-arrow-files" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-arrow-files" class="anchor"></a>2. Creating Arrow Files</h1>
<p>For this tutorial, we will download a collection of fragment files. Fragment files are one of the base file types of the 10x Genomics analytical platform (and other platforms) and can be easily created from any BAM file. See <a href="articles/Articles/inputFiles.html">the ArchR input file types vignette</a> for information on making your own fragment files for input to ArchR. Once we have our fragment files, we provide their paths as a character vector to <code><a href="../../reference/createArrowFiles.html">createArrowFiles()</a></code>. During creation, some basic metadata and matrices are added to each <code>ArrowFile</code> including a “TileMatrix” containing insertion counts across genome-wide 500-bp bins (see <code><a href="../../reference/addTileMatrix.html">addTileMatrix()</a></code>) and a “GeneScoreMatrix” that is determined based on weighting insertion counts in tiles nearby a gene promoter (see <code><a href="../../reference/addGeneScoreMatrix.html">addGeneScoreMatrix()</a></code>). These gene activity scores are described in more depth in the <a href="articles/Articles/geneScores.html">Gene Activity Score vignette</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Get Tutorial Data ~2.2GB To Download (if downloaded already ArchR will bypass downloading).</span>
inputFiles &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getTutorialData.html">getTutorialData</a></span>(<span class="st">"Hematopoiesis"</span>)

<span class="co">#Create Arrow Files (~10-15 minutes) w/ helpful messages displaying progress.</span>
<span class="co">#For each sample, this step will:</span>
<span class="co"># 1. Read accessible fragments.</span>
<span class="co"># 2. Calculate QC Information for each cell (TSS Enrichment, Nucleosome info).</span>
<span class="co"># 3. Filter cells based on QC parameters.</span>
<span class="co"># 4. Create a genome-wide TileMatrix using 500-bp bins.</span>
<span class="co"># 5. Create a GeneScoreMatrix using the provided geneAnnotation.</span>
ArrowFiles &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/createArrowFiles.html">createArrowFiles</a></span>(
  <span class="dt">inputFiles =</span> inputFiles,
  <span class="dt">sampleNames =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(inputFiles),
  <span class="dt">geneAnnotation =</span> geneAnno,
  <span class="dt">genomeAnnotation =</span> genomeAnno,
  <span class="dt">filterTSS =</span> <span class="dv">4</span>,
  <span class="dt">filterFrags =</span> <span class="dv">1000</span>,
  <span class="dt">addTileMat =</span> <span class="ot">TRUE</span>,
  <span class="dt">addGeneScoreMat =</span> <span class="ot">TRUE</span>
  )</code></pre></div>
<hr>
<div id="qc-tss-scores-by-unique-fragments" class="section level2">
<h2 class="hasAnchor">
<a href="#qc-tss-scores-by-unique-fragments" class="anchor"></a>QC TSS Scores by Unique Fragments</h2>
<p>Since this was plotted prior to creation of an ArchRProject we go to QualityControl/scATAC_BMMC_R2/scATAC_BMMC_R2-TSS_by_Unique_Frags.pdf for the plot below.</p>
<div class="figure">
<img src="../../images/Tutorial2/scATAC_BMMC_R2-TSS_by_Unique_Frags_1.png" width="600" height="600">
</div>
</div>
<div id="qc-fragment-size-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#qc-fragment-size-distribution" class="anchor"></a>QC Fragment Size Distribution</h2>
<p>Since this was plotted prior to creation of an ArchRProject we go to QualityControl/scATAC_BMMC_R2/scATAC_BMMC_R2-Fragment_Size_Distribution.pdf for the plot below.</p>
<div class="figure">
<img src="../../images/Tutorial2/scATAC_BMMC_R2-Fragment_Size_Distribution_1.png" width="600" height="400">
</div>
</div>
</div>
<div id="tidying-up-our-data-and-creating-an-archrproject" class="section level1">
<h1 class="hasAnchor">
<a href="#tidying-up-our-data-and-creating-an-archrproject" class="anchor"></a>4. Tidying up our data and creating an <code>ArchRProject</code>
</h1>
<p>One major source of trouble in single-cell data is the contribution of “doublets” to the analysis. A doublet refers to a single droplet that received a single barcoded bead and more than one nucleus. This causes the reads from more than one cell to appear as a single cell. We remove these computationally and describe this doublet removal process in more depth in the <a href="articles/Articles/doubletRemoval.html">doublet removal vignette</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Add Infered Doublet Scores to each Arrow File (~2-5 min per sample)</span>
doubScores &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addDoubletScores.html">addDoubletScores</a></span>(ArrowFiles)

<span class="co">#Create ArchRProject</span>
<span class="co">#The outputDirectory here describes where all downstream analyses and plots go.</span>
proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/ArchRProject.html">ArchRProject</a></span>(
  <span class="dt">ArrowFiles =</span> ArrowFiles, 
  <span class="dt">geneAnnotation =</span> geneAnno,
  <span class="dt">genomeAnnotation =</span> genomeAnno,
  <span class="dt">outputDirectory =</span> <span class="st">"Heme_Tutorial2"</span>
)

<span class="co">#To see information about ArchR Project created simply input</span>
proj

<span class="co">#We can now visualize numeric metadata per grouping with a violin plot now that we have created an ArchR Project.</span>
<span class="co">#For example we will plot TSS / Doublet Enrichment Scores per sample.</span>
plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, 
  <span class="dt">groupBy =</span> <span class="st">"Sample"</span>, 
  <span class="dt">colorBy =</span> <span class="st">"colData"</span>, 
  <span class="dt">name =</span> <span class="st">"TSSEnrichment"</span>,
)
plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, 
  <span class="dt">groupBy =</span> <span class="st">"Sample"</span>, 
  <span class="dt">colorBy =</span> <span class="st">"colData"</span>, 
  <span class="dt">name =</span> <span class="st">"DoubletEnrichment"</span>,
)
<span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"TSS-Doublet-Enrichment"</span>, <span class="dt">width =</span> <span class="dv">4</span>, <span class="dt">height =</span> <span class="dv">4</span>,  <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)

<span class="co">#Filter Doublets</span>
<span class="co">#The automatic filtering rate will be based on how many cells are in the sample, if there</span>
<span class="co">#are 5,000 cells ArchR will remove up to 250 (~5%) of the cells. If you believe more cells</span>
<span class="co">#should be excluded change the filterRatio argument apropriately.</span>
proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/filterDoublets.html">filterDoublets</a></span>(proj)</code></pre></div>
<hr>
<div id="example-doublet-results" class="section level2">
<h2 class="hasAnchor">
<a href="#example-doublet-results" class="anchor"></a>Example Doublet Results</h2>
<p>Since this was plotted prior to creation of an ArchRProject we go to QualityControl/scATAC_BMMC_R2/scATAC_BMMC_R2-Doublet-Summary.pdf for the plot below.</p>
<div id="section" class="section level3">
<h3 class="hasAnchor">
<a href="#section" class="anchor"></a>1</h3>
<div class="figure">
<img src="../../images/Tutorial2/scATAC_BMMC_R2-Doublet-Summary_1.png" width="600" height="600">
</div>
</div>
<div id="section-1" class="section level3">
<h3 class="hasAnchor">
<a href="#section-1" class="anchor"></a>2</h3>
<div class="figure">
<img src="../../images/Tutorial2/scATAC_BMMC_R2-Doublet-Summary_2.png" width="600" height="600">
</div>
</div>
<div id="section-2" class="section level3">
<h3 class="hasAnchor">
<a href="#section-2" class="anchor"></a>3</h3>
<div class="figure">
<img src="../../images/Tutorial2/scATAC_BMMC_R2-Doublet-Summary_3.png" width="600" height="600">
</div>
</div>
</div>
<div id="tss-doublet-enrichment" class="section level2">
<h2 class="hasAnchor">
<a href="#tss-doublet-enrichment" class="anchor"></a>TSS / Doublet Enrichment</h2>
<div id="section-3" class="section level3">
<h3 class="hasAnchor">
<a href="#section-3" class="anchor"></a>1</h3>
<div class="figure">
<img src="../../images/Tutorial2/TSS-Doublet-Enrichment_1.png" width="600" height="600">
</div>
</div>
<div id="section-4" class="section level3">
<h3 class="hasAnchor">
<a href="#section-4" class="anchor"></a>2</h3>
<div class="figure">
<img src="../../images/Tutorial2/TSS-Doublet-Enrichment_2.png" width="600" height="600">
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#getting-set-up">1. Getting Set Up</a></li>
      <li>
<a href="#creating-arrow-files">2. Creating Arrow Files</a><ul class="nav nav-pills nav-stacked">
<li><a href="#qc-tss-scores-by-unique-fragments">QC TSS Scores by Unique Fragments</a></li>
      <li><a href="#qc-fragment-size-distribution">QC Fragment Size Distribution</a></li>
      </ul>
</li>
      <li>
<a href="#tidying-up-our-data-and-creating-an-archrproject">4. Tidying up our data and creating an <code>ArchRProject</code></a><ul class="nav nav-pills nav-stacked">
<li><a href="#example-doublet-results">Example Doublet Results</a></li>
      <li><a href="#tss-doublet-enrichment">TSS / Doublet Enrichment</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://twitter.com/JeffreyGranja">Jeffrey Granja</a>, <a href="https://twitter.com/doctorcorces">Ryan Corces</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
