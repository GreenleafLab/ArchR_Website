# Footprinting with ArchR

```{r, include=FALSE}
setwd("/Volumes/JG_SSD_2/ArchR_Walkthrough/")
#load("Save-ArchR-Walkthrough-Chapter1-Feb13.Rdata")
save.image("Save-ArchR-Walkthrough-Feb17-0254.Rdata")
```

## Motif Footprinting

Transcription factor footprinting can also be done in ArchR with a single command. We note that the footprints generated by the tutorial data are not as clean as would be desired but this is because of the small size of the tutorial dataset.

```{r eval=FALSE}
motifPositions <- getPositions(projHeme5)
motifPositions
# GRangesList object of length 870:
# $TFAP2B_1 
# GRanges object with 18839 ranges and 1 metadata column:
#           seqnames              ranges strand |            score
#              <Rle>           <IRanges>  <Rle> |        <numeric>
#       [1]     chr1       874977-874988      + |  8.1040240314385
#       [2]     chr1       876278-876289      + | 9.07480855168228
#       [3]     chr1       878394-878405      + | 8.13251230888635
#       [4]     chr1       878394-878405      - | 8.55091380875033
#       [5]     chr1       896470-896481      + | 8.82805137346104
#       ...      ...                 ...    ... .              ...
#   [18835]     chrX 154299568-154299579      + | 8.86292599058688
#   [18836]     chrX 154299568-154299579      - | 8.08701861760796
#   [18837]     chrX 154664929-154664940      - | 8.12813446630685
#   [18838]     chrX 154807684-154807695      + | 9.53908578301561
#   [18839]     chrX 154807684-154807695      - | 10.5729555847813

# ...
# <869 more elements>
# -------
# seqinfo: 23 sequences from an unspecified genome; no seqlengths
```

Find TF-Motifs

```{r eval=FALSE}
motifs <- c("GATA1", "CEBPA", "EBF1", "IRF4", "TBX21", "PAX5")
markerMotifs <- unlist(lapply(motifs, function(x) grep(x, names(motifPositions), value = TRUE)))
markerMotifs <- markerMotifs[markerMotifs %ni% "SREBF1_22"]
markerMotifs
# [1] "GATA1_383" "CEBPA_155" "EBF1_67"   "IRF4_632"  "TBX21_780" "PAX5_709" 
```

```{r eval=FALSE}
#Create Group Coverage Files if you have not done so already
projHeme5 <- addGroupCoverages(ArchRProj = projHeme5, groupBy = "Clusters2")
```

### No Normalization

```{r eval=FALSE}
#Plot Motif Footprints from positions list
#Recommend doing a few motifs not entire motif set
seFoot_None <- plotFootprints(
  ArchRProj = projHeme5, 
  positions = motifPositions[markerMotifs], 
  groupBy = "Clusters2",
  normMethod = "none",
  plotName = "Footprints-No-Normalization"
)
```

By default the plots will be in the outputDirectory of the ArchRProject. The challenge is that if you requested to plot all motifs and returned this as a ggplot object it could be extremely large. An example of motif footprints ran from this function are seen below.

![](images/HemeWalkthrough/PNG/Footprints-No-Normalization_1.png){width=250 height=400}
![](images/HemeWalkthrough/PNG/Footprints-No-Normalization_2.png){width=250 height=400}
![](images/HemeWalkthrough/PNG/Footprints-No-Normalization_3.png){width=250 height=400}

### Divide Tn5 Bias 

```{r eval=FALSE}
#Re-Plot with different normalization method
seFoot_Divide <- plotFootprints(
  ArchRProj = projHeme5, 
  inputSE = seFoot_None, 
  positions = motifPositions[markerMotifs], 
  groupBy = "Clusters2",
  normMethod = "divide",
  plotName = "Footprints-Divide-Bias"
)
```

By default the plots will be in the outputDirectory of the ArchRProject. The challenge is that if you requested to plot all motifs and returned this as a ggplot object it could be extremely large. An example of motif footprints ran from this function are seen below.

![](images/HemeWalkthrough/PNG/Footprints-Divide-Bias_1.png){width=250 height=400}
![](images/HemeWalkthrough/PNG/Footprints-Divide-Bias_2.png){width=250 height=400}
![](images/HemeWalkthrough/PNG/Footprints-Divide-Bias_3.png){width=250 height=400}

### Subtract Tn5 Bias 

```{r eval=FALSE}
#Re-Plot with different normalization method
seFoot_Subtract <- plotFootprints(
  ArchRProj = projHeme5, 
  inputSE = seFoot_None, 
  positions = motifPositions[markerMotifs], 
  groupBy = "Clusters2",
  normMethod = "subtract",
  plotName = "Footprints-Subtract-Bias"
)
```

By default the plots will be in the outputDirectory of the ArchRProject. The challenge is that if you requested to plot all motifs and returned this as a ggplot object it could be extremely large. An example of motif footprints ran from this function are seen below.

![](images/HemeWalkthrough/PNG/Footprints-Subtract-Bias_1.png){width=250 height=400}
![](images/HemeWalkthrough/PNG/Footprints-Subtract-Bias_2.png){width=250 height=400}
![](images/HemeWalkthrough/PNG/Footprints-Subtract-Bias_3.png){width=250 height=400}


## Feature Footprinting

```{r eval=FALSE}
#Create Group Coverage Files if you have not done so already
projHeme5 <- addGroupCoverages(ArchRProj = projHeme5, groupBy = "Clusters2")
```

### No Normalization

```{r eval=FALSE}
#Plot Motif Footprints from positions list
#Recommend doing a few motifs not entire motif set
seTSS_None <- plotFootprints(
  ArchRProj = projHeme5, 
  positions = GRangesList(TSS = getTSS(projHeme5)), 
  groupBy = "Clusters2",
  normMethod = "none",
  plotName = "TSS-No-Normalization",
  flank = 2000,
  flankNorm = 100
)
```

By default the plots will be in the outputDirectory of the ArchRProject. The challenge is that if you requested to plot all motifs and returned this as a ggplot object it could be extremely large. An example of motif footprints ran from this function are seen below.

<center>
![](images/HemeWalkthrough/PNG/TSS-No-Normalization_1.png){width=250 height=400}
</center>











