# Clustering with ArchR

```{r, include=FALSE, eval=FALSE}
setwd("/Volumes/JG_SSD_2/ArchR_Walkthrough/")
#load("Save-ArchR-Walkthrough-Chapter1-Feb13.Rdata")
save.image("Save-ArchR-Walkthrough-Feb13-2130.Rdata")
```

Most single-cell clustering methods focus on computing nearest neighbor graphs in reduced dimensions and then identifying "communities" or clusters. These approaches work extremely well and are a standard practice in scRNA. For this reason, we import existing state of the art clustering methods from scRNA-seq packages for clustering. In our experience, we have had the most success using Seurat's (https://github.com/satijalab/seurat) graph clustering approach. Additional clustering params can be passed to `Seurat::FindClusters` from this function.

```{r eval=FALSE}
projHeme2 <- addClusters(
	input = projHeme2,
    reducedDims = "IterativeLSI",
    method = "Seurat",
    name = "Clusters",
    resolution = 0.8
)
```

To access these clusters we can use the `$` accessor

```{r eval=FALSE}
head(projHeme2$Clusters)
# [1] "Cluster11" "Cluster2"  "Cluster12" "Cluster1"  "Cluster12" "Cluster8"

table(projHeme2$Clusters)
# Cluster1 Cluster10 Cluster11 Cluster12 Cluster13 Cluster14  Cluster2  Cluster3 
#       28      1070       425       351       408       345      1330       562 
# Cluster4  Cluster5  Cluster6  Cluster7  Cluster8  Cluster9 
#      901       860      1218       974       274      1505
```

We can also create a cluster confusion matrix across each sample. JJJ

```{r eval=FALSE}
ArchR:::.confusionMatrix(paste0(projHeme2$Clusters), paste0(projHeme2$Sample))
# 14 x 3 sparse Matrix of class "dgCMatrix"
#           scATAC_BMMC_R1 scATAC_CD34_BMMC_R1 scATAC_PBMC_R1
# Cluster11            247                   6            172
# Cluster2            1254                   .             76
# Cluster12            351                   .              .
# Cluster1              28                   .              .
# Cluster8             247                  27              .
# Cluster4             315                   .            586
# Cluster9            1456                   5             44
# Cluster5             214                 639              7
# Cluster7              83                 887              4
# Cluster14            161                 174             10
# Cluster3              52                   .            510
# Cluster10             84                   1            985
# Cluster6             117                1101              .
# Cluster13             80                 328              .
```

Determining the appropriate cluster params is useful once you have computed a 2-dimensional embedding. This is because you should be adjusting both the clustering and embedding params to where they both agree. 

Additionally, one can call clusters with scran (https://bioconductor.org/packages/release/bioc/html/scran.html).

```{r eval=FALSE}
projHeme2 <- addClusters(
    input = projHeme2,
    reducedDims = "IterativeLSI",
    method = "scran",
    name = "ScranClusters",
    k = 15
)
```









