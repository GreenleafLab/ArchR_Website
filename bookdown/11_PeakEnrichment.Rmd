# Peak Annotation Enrichment with ArchR

```{r, include=FALSE}
setwd("/Volumes/JG_SSD_2/ArchR_Walkthrough/")
#load("Save-ArchR-Walkthrough-Chapter1-Feb13.Rdata")
save.image("Save-ArchR-Walkthrough-Feb17-0254.Rdata")
```

## Motif Enrichment


```{r eval=FALSE}
#Motif Search in Peak Set and add to Peak Annotations
projHeme5 <- addMotifAnnotations(ArchRProj = projHeme5, motifSet = "cisbp", name = "Motif")

#Identify Motif Enrichments
enrichMotifs <- peakAnnoEnrichment(
    seMarker = markersPeaks,
    ArchRProj = projHeme5,
    peakAnnotation = "Motif",
    cutOff = "FDR <= 0.1 & Log2FC >= 0.5"
  )
enrichMotifs
# class: SummarizedExperiment 
# dim: 870 14 
# metadata(0):
# assays(10): mlog10Padj mlog10p ... CompareFrequency feature
# rownames(870): TFAP2B_1 TFAP2D_2 ... TBX18_869 TBX22_870
# rowData names(0):
# colnames(14): C1_Early.Eryth C2_CD4.N1 ... C13_CLP.2 C14_pDC
# colData names(0):

#Heatmap
heatmapEM <- enrichHeatmap(enrichMotifs, n = 7, transpose = TRUE)
draw(heatmapEM, heatmap_legend_side = "bot", annotation_legend_side = "bot")
```
![](images/HemeWalkthrough/PNG/Motifs-Enriched-Marker-Heatmap_1.png){width=800 height=600}

We can then plot this 

```{r eval=FALSE}
plotPDF(heatmapEM, name = "Motifs-Enriched-Marker-Heatmap", width = 8, height = 6, ArchRProj = projHeme5, addDOC = FALSE)
```

## ArchR Enrichment

### Encode TFBS

```{r eval=FALSE}
projHeme5 <- addArchRAnnotations(ArchRProj = projHeme5, collection = "EncodeTFBS")

#Identify EncodeTFBS Enrichments
enrichEncode <- peakAnnoEnrichment(
    seMarker = markersPeaks,
    ArchRProj = projHeme5,
    peakAnnotation = "EncodeTFBS",
    cutOff = "FDR <= 0.1 & Log2FC >= 0.5"
  )
enrichEncode
# class: SummarizedExperiment 
# dim: 689 14 
# metadata(0):
# assays(10): mlog10Padj mlog10p ... CompareFrequency feature
# rownames(689): 1.CTCF-Dnd41... 2.EZH2_39-Dnd41... ...
#   688.CTCF-WERI_Rb_1... 689.CTCF-WI_38...
# rowData names(0):
# colnames(14): C1_Early.Eryth C2_CD4.N1 ... C13_CLP.2 C14_pDC
# colData names(0):

#Heatmap
heatmapEncode <- enrichHeatmap(enrichEncode, n = 7, transpose = TRUE)
draw(heatmapEncode, heatmap_legend_side = "bot", annotation_legend_side = "bot")
```
![](images/HemeWalkthrough/PNG/EncodeTFBS-Enriched-Marker-Heatmap_1.png){width=800 height=600}

We can then plot this 

```{r eval=FALSE}
plotPDF(heatmapEncode, name = "EncodeTFBS-Enriched-Marker-Heatmap", width = 8, height = 6, ArchRProj = projHeme5, addDOC = FALSE)
```

### Bulk ATAC-seq

```{r eval=FALSE}
projHeme5 <- addArchRAnnotations(ArchRProj = projHeme5, collection = "ATAC")

#Identify ATAC Enrichments
enrichATAC <- peakAnnoEnrichment(
    seMarker = markersPeaks,
    ArchRProj = projHeme5,
    peakAnnotation = "ATAC",
    cutOff = "FDR <= 0.1 & Log2FC >= 0.5"
  )
enrichATAC
# class: SummarizedExperiment 
# dim: 96 14 
# metadata(0):
# assays(10): mlog10Padj mlog10p ... CompareFrequency feature
# rownames(96): Brain_Astrocytes Brain_Excitatory_neurons ... Heme_MPP
#   Heme_NK
# rowData names(0):
# colnames(14): C1_Early.Eryth C2_CD4.N1 ... C13_CLP.2 C14_pDC
# colData names(0):

#Heatmap
heatmapATAC <- enrichHeatmap(enrichATAC, n = 7, transpose = TRUE)
draw(heatmapATAC, heatmap_legend_side = "bot", annotation_legend_side = "bot")
```
![](images/HemeWalkthrough/PNG/ATAC-Enriched-Marker-Heatmap_1.png){width=800 height=600}

We can then plot this 

```{r eval=FALSE}
plotPDF(heatmapATAC, name = "ATAC-Enriched-Marker-Heatmap", width = 8, height = 6, ArchRProj = projHeme5, addDOC = FALSE)
```

### Codex TFBS

```{r eval=FALSE}
projHeme5 <- addArchRAnnotations(ArchRProj = projHeme5, collection = "Codex")

#Identify Codex Enrichments
enrichCodex <- peakAnnoEnrichment(
    seMarker = markersPeaks,
    ArchRProj = projHeme5,
    peakAnnotation = "Codex",
    cutOff = "FDR <= 0.1 & Log2FC >= 0.5"
  )
enrichCodex
# class: SummarizedExperiment 
# dim: 189 14 
# metadata(0):
# assays(10): mlog10Padj mlog10p ... CompareFrequency feature
# rownames(189): 1.STAT5-No_drug_(DMSO)... 2.RUNX3-GM12878_cell_fr... ...
#   188.TP53-codex_Embryonic... 189.TP53-codex_Embryonic...
# rowData names(0):
# colnames(14): C1_Early.Eryth C2_CD4.N1 ... C13_CLP.2 C14_pDC
# colData names(0):

#Heatmap
heatmapCodex <- enrichHeatmap(enrichCodex, n = 7, transpose = TRUE)
draw(heatmapCodex, heatmap_legend_side = "bot", annotation_legend_side = "bot")
```
![](images/HemeWalkthrough/PNG/Codex-Enriched-Marker-Heatmap_1.png){width=800 height=600}

We can then plot this 

```{r eval=FALSE}
plotPDF(heatmapCodex, name = "Codex-Enriched-Marker-Heatmap", width = 8, height = 6, ArchRProj = projHeme5, addDOC = FALSE)
```

## Custom Enrichment

```{r eval=FALSE}
#Custom Peak Annotations
EncodePeaks <- c(
  Encode_K562_GATA1 = "https://www.encodeproject.org/files/ENCFF632NQI/@@download/ENCFF632NQI.bed.gz",
  Encode_GM12878_CEBPB = "https://www.encodeproject.org/files/ENCFF761MGJ/@@download/ENCFF761MGJ.bed.gz",
  Encode_K562_Ebf1 = "https://www.encodeproject.org/files/ENCFF868VSY/@@download/ENCFF868VSY.bed.gz",
  Encode_K562_Pax5 = "https://www.encodeproject.org/files/ENCFF339KUO/@@download/ENCFF339KUO.bed.gz"
)
projHeme5 <- addPeakAnnotations(ArchRProj = projHeme5, regions = EncodePeaks, name = "ChIP")

#Identify ChIP Enrichments
enrichRegions <- peakAnnoEnrichment(
    seMarker = markersPeaks,
    ArchRProj = projHeme5,
    peakAnnotation = "ChIP",
    cutOff = "FDR <= 0.1 & Log2FC >= 0.5"
  )
enrichRegions
# class: SummarizedExperiment 
# dim: 4 14 
# metadata(0):
# assays(10): mlog10Padj mlog10p ... CompareFrequency feature
# rownames(4): Encode_K562_GATA1 Encode_GM12878_CEBPB Encode_K562_Ebf1
#   Encode_K562_Pax5
# rowData names(0):
# colnames(14): C1_Early.Eryth C2_CD4.N1 ... C13_CLP.2 C14_pDC
# colData names(0):

#Heatmap
heatmapRegions <- enrichHeatmap(enrichRegions, n = 7, transpose = TRUE)
draw(heatmapRegions, heatmap_legend_side = "bot", annotation_legend_side = "bot")
```
![](images/HemeWalkthrough/PNG/Regions-Enriched-Marker-Heatmap_1.png){width=800 height=600}

We can then plot this 

```{r eval=FALSE}
plotPDF(heatmapRegions, name = "Regions-Enriched-Marker-Heatmap", width = 8, height = 6, ArchRProj = projHeme5, addDOC = FALSE)
```














